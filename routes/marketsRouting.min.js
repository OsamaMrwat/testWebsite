const express=require("express"),router=express.Router(),fetch=require("node-fetch"),yahooFinance=require("yahoo-finance"),butter=require("buttercms")(process.env.BUTTER_KEY);router.get("/",(t,e)=>{var n={fields:{seo:{meta_description:"test",meta_keyword:"test"},title:"test"}};e.render("Markets/markets",{page:n})}),router.get("/markets",(t,e)=>{e.redirect("/markets")}),router.get("/stocks/us-stocks",async(t,e)=>{const n="https://script.google.com/macros/s/AKfycbx-demXMS4gLaI7KkjVN-GPvHoYEnta8j5WuIIkvxpn94oT7dPEH-wObUgFXatkKN4L/exec",s={method:"GET"};let r=[];await fetch(n,s).then(t=>t.json()).then(t=>{const e=t.data;e.forEach(t=>{"US Stocks"==t.Market&&r.push(t)})});var o="";const a=r.map(t=>(fetch(`https://yfapi.net/ws/insights/v1/finance/insights?symbol=${t.Symbol}`,{method:"GET",headers:{"Content-Type":"application/json","X-API-KEY":"ey1Pl4aShiaVWabUX4hc42GOjOr1ONMK9BRaA9OK"}}).then(t=>t.json()).then(e=>{o=`<tr class="${t.Sector} ${t.Industry}">\n        <th>${t.PandaAssetName}</th>\n        <th>${t.Price}</th>\n        <th>${t.ChangePct}</th>\n        <th>${t.Change}</th>\n        <th>${e.finance.result.instrumentInfo.recommendation.rating}</th>\n        <th>${t.Volume.toLocaleString("en-US")}</th>\n        <th>${t.MarketCAP.toLocaleString("en-US")}</th>\n        </tr>`}).catch(t=>{console.log(t)}),console.log(o),`<tr class="${t.Sector} ${t.Industry}">\n        <th>${t.PandaAssetName}</th>\n        <th>${t.Price}</th>\n        <th>${t.ChangePct}</th>\n        <th>${t.Change}</th>\n        <th>${o}</th>\n        <th>${t.Volume.toLocaleString("en-US")}</th>\n        <th>${t.MarketCAP.toLocaleString("en-US")}</th>\n        </tr>`)).join(" ");var h={fields:{seo:{meta_description:"test",meta_keyword:"test"},title:"test"}};e.render("Markets/usStocks",{page:h,stocks:a})}),module.exports=router;